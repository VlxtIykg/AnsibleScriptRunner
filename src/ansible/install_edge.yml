---
- name: Install Microsoft Edge
  hosts: all
  become: true

  tasks:
    - name: Download Microsoft GPG key
      shell: curl https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor > microsoft.gpg
      args:
        chdir: /tmp

    - name: Copy Microsoft GPG key to trusted location
      copy:
        src: /tmp/microsoft.gpg
        dest: /etc/apt/trusted.gpg.d/microsoft.gpg
        owner: root
        group: root
        mode: '0644'

    - name: Add Microsoft Edge repository
      lineinfile:
        path: /etc/apt/sources.list.d/microsoft-edge-dev.list
        line: 'deb [arch=amd64] https://packages.microsoft.com/repos/edge stable main'
        create: yes

    - name: Remove temporary GPG key file
      file:
        path: /tmp/microsoft.gpg
        state: absent

    - name: Update apt cache
      apt:
        update_cache: yes

    - name: Install Microsoft Edge
      apt:
        name: microsoft-edge-stable
        state: present